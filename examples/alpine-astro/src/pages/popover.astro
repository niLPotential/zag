---
import { getControlDefaults, popoverControls } from "@zag-js/shared"
import Layout from "../layouts/Layout.astro"
import Presence from "../components/Presence.astro"
import Toolbar from "../components/Toolbar.astro"
import Controls from "../components/Controls.astro"
import StateVisualizer from "../components/StateVisualizer.astro"
import Nav from "../components/Nav.astro"

const state = getControlDefaults(popoverControls)
---

<script>
  import * as popover from "@zag-js/popover"
  import Alpine from "alpinejs"
  import { usePlugin } from "../lib"

  Alpine.plugin(usePlugin("popover", popover))
</script>

<Layout>
  <div
    class="page"
    x-data={JSON.stringify(state)}
    x-id="['popover']"
    x-popover={`{id: $id('popover'), ${Object.keys(state)}}`}
  >
    <Nav />
    <main class="popover">
      <div data-part="root">
        <button data-testid="button-before">Button :before</button>

        <button data-testid="popover-trigger" x-popover:trigger>
          Click me
          <div x-popover:indicator>{">"}</div>
        </button>

        <div x-popover:anchor>anchor</div>

        <template x-teleport="body">
          <div x-popover:positioner>
            <Presence data-testid="popover-content" class="popover-content" x-popover:content>
              <div x-popover:arrow>
                <div x-popover:arrow-tip></div>
              </div>
              <div data-testid="popover-title" x-popover:title>Popover Title</div>
              <div data-part="body" data-testid="popover-body">
                <a>Non-focusable Link</a>
                <a href="#" data-testid="focusable-link"> Focusable Link </a>
                <input data-testid="input" placeholder="input" />
                <button data-testid="popover-close-button" x-popover:close-trigger> X </button>
              </div>
            </Presence>
          </div>
        </template>
        <span data-testid="plain-text">I am just text</span>
        <button data-testid="button-after">Button :after</button>
      </div>
    </main>

    <Toolbar>
      <Controls config={popoverControls} {state} slot="controls" />
      <StateVisualizer label="popover" />
    </Toolbar>
  </div>
</Layout>
